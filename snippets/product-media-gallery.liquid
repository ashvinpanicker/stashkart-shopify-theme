{% comment %}
  Renders a product media gallery with a featured image and vertical thumbnails
  Accepts:
  - product: {Object} Product liquid object
  - variant_images: {Array} Product images associated with a variant
{% endcomment %}

{{ 'component-product-gallery.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-gallery.js' | asset_url }}" defer="defer"></script>

<div class="product-gallery" data-product-gallery>
  <div class="product-gallery__thumbnails">
    {%- if product.selected_or_first_available_variant.featured_media != null -%}
      {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
      <button class="product-gallery__thumbnail" data-thumbnail
        data-main-src="{{ featured_media | image_url: width: 1200 }}"
        data-main-srcset="
          {{ featured_media | image_url: width: 800 }} 800w,
          {{ featured_media | image_url: width: 1200 }} 1200w,
          {{ featured_media | image_url: width: 1600 }} 1600w,
          {{ featured_media | image_url: width: 2000 }} 2000w,
          {{ featured_media | image_url: width: 2400 }} 2400w,
          {{ featured_media | image_url: width: 3000 }} 3000w
        ">
        <img
          src="{{ featured_media | image_url: width: 200 }}"
          loading="lazy"
          width="100"
          height="100"
          alt="{{ featured_media.alt | escape }}"
        >
      </button>
    {%- endif -%}

    {%- for media in product.media -%}
      {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
        <button class="product-gallery__thumbnail" data-thumbnail
          data-main-src="{{ media | image_url: width: 1200 }}"
          data-main-srcset="
            {{ media | image_url: width: 800 }} 800w,
            {{ media | image_url: width: 1200 }} 1200w,
            {{ media | image_url: width: 1600 }} 1600w,
            {{ media | image_url: width: 2000 }} 2000w,
            {{ media | image_url: width: 2400 }} 2400w,
            {{ media | image_url: width: 3000 }} 3000w
          ">
          <img
            src="{{ media | image_url: width: 200 }}"
            loading="lazy"
            width="100"
            height="100"
            alt="{{ media.alt | escape }}"
          >
        </button>
      {%- endunless -%}
    {%- endfor -%}
  </div>

  <div class="product-gallery__main">
    {%- if product.selected_or_first_available_variant.featured_media != null -%}
      {%- assign featured_media_id = product.selected_or_first_available_variant.featured_media.id -%}
    {%- else -%}
      {%- assign featured_media_id = product.media[0].id -%}
    {%- endif -%}

    {%- for media in product.media -%}
      <div class="product-gallery__media-item {% unless media.id == featured_media_id %}hidden{% endunless %}" 
           data-media-id="{{ media.id }}" 
           data-media-type="{{ media.media_type }}"
           {% if media.media_type == 'model' %}style="width: 100%; aspect-ratio: {{ media.aspect_ratio | default: 1 }};"{% endif %}
      >
        {%- case media.media_type -%}
          {%- when 'image' -%}
            <img
              class="product-gallery__main-image"
              src="{{ media | image_url: width: 1200 }}"
              srcset="
                {{ media | image_url: width: 800 }} 800w,
                {{ media | image_url: width: 1200 }} 1200w,
                {{ media | image_url: width: 1600 }} 1600w,
                {{ media | image_url: width: 2000 }} 2000w,
                {{ media | image_url: width: 2400 }} 2400w,
                {{ media | image_url: width: 3000 }} 3000w
              "
              sizes="(max-width: 600px) 100vw, 600px"
              alt="{{ media.alt | escape }}"
              loading="lazy"
              width="{{ media.width }}"
              height="{{ media.height }}"
            >
          {%- when 'model' -%}
            <div class="product-media-model-wrapper" style="width: 100%; height: 100%; min-height: 500px;">
              {{ media | model_viewer_tag: image_size: '1200x', toggleable: true, data-model-id: media.id, style: 'width: 100%; height: 100%;' }}
            </div>
          {%- when 'video' -%}
             {{ media | video_tag: controls: true, image_size: "1200x" }}
          {%- when 'external_video' -%}
             {{ media | external_video_tag: image_size: "1200x" }}
        {%- endcase -%}
      </div>
    {%- endfor -%}
  </div>
</div>
